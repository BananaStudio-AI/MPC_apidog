version: '3.8'

services:
  litellm:
    image: ghcr.io/berriai/litellm:main-latest
    restart: always
    ports:
      - "4000:4000"
    environment:
      # Master key for authentication
      LITELLM_MASTER_KEY: ${LITELLM_MASTER_KEY:-sk-1234}
      
      # Model provider API keys
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      COHERE_API_KEY: ${COHERE_API_KEY:-}
      REPLICATE_API_KEY: ${REPLICATE_API_KEY:-}
      HUGGINGFACE_API_KEY: ${HUGGINGFACE_API_KEY:-}
      
      # LiteLLM settings
      LITELLM_LOG_LEVEL: ${LITELLM_LOG_LEVEL:-INFO}
      
      # Database for logging (optional)
      DATABASE_URL: ${LITELLM_DATABASE_URL:-}
      
    command: >
      --config /app/config.yaml
      --port 4000
      --num_workers 4
    volumes:
      - ../../litellm_config.yaml:/app/config.yaml:ro
      - litellm_logs:/app/logs
    networks:
      - ai-infra-net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

volumes:
  litellm_logs:

networks:
  ai-infra-net:
    external: true
