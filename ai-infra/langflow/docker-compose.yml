version: '3.8'

services:
  langflow:
    image: langflowai/langflow:latest
    restart: always
    ports:
      - "7860:7860"
    environment:
      # Langflow Configuration
      LANGFLOW_HOST: 0.0.0.0
      LANGFLOW_PORT: 7860
      
      # Database (SQLite by default, stored in volume)
      LANGFLOW_DATABASE_URL: sqlite:////app/langflow/langflow.db
      
      # Storage for flows and components
      LANGFLOW_STORE: /app/langflow/store
      
      # Optional: LiteLLM Gateway Integration
      # Uncomment and configure if you have a LiteLLM gateway running
      # OPENAI_API_BASE: ${LITELLM_BASE_URL:-http://host.docker.internal:4000}
      # OPENAI_API_KEY: ${LITELLM_API_KEY:-sk-local-dev-key}
      
      # Alternative environment variable names that Langflow might support
      # LITELLM_BASE_URL: ${LITELLM_BASE_URL:-http://host.docker.internal:4000}
      # LITELLM_API_KEY: ${LITELLM_API_KEY:-sk-local-dev-key}
      
      # Log level
      LANGFLOW_LOG_LEVEL: INFO
      
      # Workers (for concurrent requests)
      LANGFLOW_WORKERS: 1
      
      # Auto-login (dev mode only)
      LANGFLOW_AUTO_LOGIN: false
      
      # Cache configuration
      LANGFLOW_CACHE_TYPE: memory
      
    volumes:
      # Persistent storage for flows, database, and configurations
      - langflow_data:/app/langflow
      
    networks:
      - langflow-network
      
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7860/health"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 40s

networks:
  langflow-network:
    driver: bridge

volumes:
  langflow_data:
    driver: local
